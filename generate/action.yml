name: Generate Change Log
description: ''
inputs:
  output-file:
    description: ''
    required: false
    default: 'CHANGELOG.md'
  verbose:
    description: ''
    required: false
    default: false

runs:
  using: 'composite'
  steps:
  - name: checkout pr target branch
    uses: actions/checkout@v4
    with:
      ref: ${{ github.event.pull_request.base.ref }}

  - name: show current changelog
    run: |
      echo "=== current changelog contents ==="
      cat "${{ inputs.output-file }}"
    shell: bash
    if: ${{ inputs.verbose == true }}

  - name: generate new change Log
    run: |
      npm install
      node ./src/index.js "${{  github.workspace }}/${{ inputs.output-file }}"
    shell: bash
    working-directory: "${{ github.action_path }}"

  - name: show updated changelog
    run: |
      echo "=== updated changelog contents ==="
      cat "${{ inputs.output-file }}"
    shell: bash
  