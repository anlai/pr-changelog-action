name: 'PR Change Log Generator'
description: ''
inputs:
  output-file:
    description: ''
    required: false
    default: CHANGELOG.md
# runs:
#   using: 'node20'
#   main: 'src/index.js'

runs:
  using: 'composite'
  steps:
  - name: checkout
    uses: actions/checkout@v4
    with:
      ref: ${{ github.event.pull_request.base.ref }}

  # - name: Get Current Changelog
  #   uses: actions/checkout@v4
  #   with:
  #     ref: ${{ github.event.pull_request.base.ref }}
  #     sparse-checkout: |
  #       CHANGELOG.md
  #     sparse-checkout-cone-mode: false

  - name: show changelog
    run: |
      cat CHANGELOG.md
    shell: bash

  # update the changelog file

  - name: Update CHANGELOG
    run: |
      echo "${{ github.run_number }}" >> CHANGELOG.md
    shell: bash

  - name: show changelog
    run: |
      cat CHANGELOG.md
    shell: bash

  - name: show branch
    run: |
      git stash -- CHANGELOG.md
      git pull origin
      git checkout ${{ github.event.pull_request.head.ref }}
      git checkout stash -- CHANGELOG.md

      echo ""
      echo ""
      git status

      cat CHANGELOG.md
    shell: bash

  - name: DEBUG
    run: |
      ls "${{ github.action_path }}"
    shell: bash

  - name: TESTING
    run: |
      npm install @actions/core 
      npm install @actions/github
      node "${{ github.action_path }}/src/index.js" "$(pwd)/CHANGELOG.md"
    shell: bash

  # # commit the changelog file to github.event.pull_request.head.ref
  # - name: commit the changes
  #   uses: stefanzweifel/git-auto-commit-action@master
  #   with:
  #     branch: ${{ github.event.pull_request.head.ref }}
  #     commit_message: "Updating CHANGELOG from ${{ github.event.pull_request.title }}"